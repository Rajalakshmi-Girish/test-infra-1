# This file defines the list of cluster e2e tests
#
# The name of the test job in this file consists of
# several dimensions, such as cloud provider, OS image name,
# Kubernetes version and test suites.
#
# Supported tests:
#
#  * cluster e2e test
#    The name starts with "ci-kubernetes-e2e-" and must satisfy the following
#    format:
#      ci-kubernetes-e2e-<cloudProvider>-<image>-<k8sVersion>-<testSuite>

periodics:
- interval: 1h
  labels:
    preset-service-account: 'true'
    preset-k8s-ssh: 'true'
  decorate: true
  decoration_config:
    timeout: 200m
  name: ci-kubernetes-e2e-gce-cos-k8sbeta-alphafeatures
  spec:
    containers:
    - command:
      - runner.sh
      - /workspace/scenarios/kubernetes_e2e.py
      args:
      - --cluster=test-gce-cos-k8sbeta-alphafeatures
      - --check-leaked-resources
      - --provider=gce
      - --gcp-zone=us-west1-b
      - --gcp-node-image=gci
      - --extract=ci/latest-k8sbeta
      - --extract-ci-bucket=k8s-release-dev
      - --timeout=180m
      - --env=KUBE_PROXY_DAEMONSET=true
      - --env=ENABLE_POD_PRIORITY=true
      - --env=KUBE_FEATURE_GATES=AllAlpha=true,EventedPLEG=false
      - --env=ENABLE_AUTH_PROVIDER_GCP=true
      - --env=ENABLE_CACHE_MUTATION_DETECTOR=true
      - --runtime-config=api/all=true
      - --test_args=--ginkgo.focus=\[Feature:(Audit|BlockVolume|PodPreset|ExpandCSIVolumes|ExpandInUseVolumes)\]|Networking --ginkgo.skip=\[Feature:(SCTPConnectivity|Volumes|Networking-Performance|Networking-IPv6)\]|csi-hostpath-v0 --minStartupPods=8
      env:
      image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241128-8df65c072f-master
      resources:
        requests:
          cpu: 1000m
          memory: 3Gi
        limits:
          cpu: 1000m
          memory: 3Gi
  cluster: k8s-infra-prow-build
  annotations:
    testgrid-tab-name: gce-cos-k8sbeta-alphafeatures
    testgrid-dashboards: sig-release-master-blocking
    fork-per-release: "true"
    fork-per-release-replacements: "--extract=ci/latest-k8sbeta -> --extract=ci/latest-{{.Version}}"
    fork-per-release-periodic-interval: 1h 2h 6h 24h
    fork-per-release-generic-suffix: "true"
- interval: 1h
  labels:
    preset-service-account: 'true'
    preset-k8s-ssh: 'true'
  decorate: true
  decoration_config:
    timeout: 140m
  name: ci-kubernetes-e2e-gce-cos-k8sbeta-default
  spec:
    containers:
    - command:
      - runner.sh
      - /workspace/scenarios/kubernetes_e2e.py
      args:
      - --cluster=test-gce-cos-k8sbeta-default
      - --check-leaked-resources
      - --provider=gce
      - --gcp-zone=us-west1-b
      - --gcp-node-image=gci
      - --extract=ci/latest-k8sbeta
      - --extract-ci-bucket=k8s-release-dev
      - --timeout=120m
      - --test_args=--ginkgo.skip=\[Driver:.gcepd\]|\[Slow\]|\[Serial\]|\[Disruptive\]|\[Flaky\]|\[Feature:.+\] --minStartupPods=8
      - --ginkgo-parallel=30
      - --env=ENABLE_CACHE_MUTATION_DETECTOR=true
      env:
      image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241128-8df65c072f-master
      resources:
        requests:
          cpu: 2000m
          memory: 6Gi
        limits:
          cpu: 2000m
          memory: 6Gi
  cluster: k8s-infra-prow-build
  annotations:
    testgrid-tab-name: gce-cos-k8sbeta-default
    testgrid-dashboards: sig-release-master-blocking
    fork-per-release: "true"
    fork-per-release-replacements: "--extract=ci/latest-k8sbeta -> --extract=ci/latest-{{.Version}}"
    fork-per-release-periodic-interval: 1h 2h 6h 24h
    fork-per-release-generic-suffix: "true"
- interval: 1h
  labels:
    preset-service-account: 'true'
    preset-k8s-ssh: 'true'
  decorate: true
  decoration_config:
    timeout: 170m
  name: ci-kubernetes-e2e-gce-cos-k8sbeta-ingress
  spec:
    containers:
    - command:
      - runner.sh
      - /workspace/scenarios/kubernetes_e2e.py
      args:
      - --cluster=test-gce-cos-k8sbeta-ingress
      - --check-leaked-resources
      - --provider=gce
      - --gcp-zone=us-west1-b
      - --gcp-node-image=gci
      - --extract=ci/latest-k8sbeta
      - --extract-ci-bucket=k8s-release-dev
      - --timeout=150m
      - --test_args=--ginkgo.focus=\[Feature:Ingress\] --minStartupPods=8
      env:
      image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241128-8df65c072f-master
      resources:
        requests:
          cpu: 1000m
          memory: 3Gi
        limits:
          cpu: 1000m
          memory: 3Gi
  cluster: k8s-infra-prow-build
  annotations:
    testgrid-tab-name: gce-cos-k8sbeta-ingress
    testgrid-dashboards: sig-release-master-blocking
    fork-per-release: "true"
    fork-per-release-replacements: "--extract=ci/latest-k8sbeta -> --extract=ci/latest-{{.Version}}"
    fork-per-release-periodic-interval: 1h 2h 6h 24h
    fork-per-release-generic-suffix: "true"
- interval: 1h
  labels:
    preset-service-account: 'true'
    preset-k8s-ssh: 'true'
  decorate: true
  decoration_config:
    timeout: 200m
  name: ci-kubernetes-e2e-gce-cos-k8sbeta-reboot
  spec:
    containers:
    - command:
      - runner.sh
      - /workspace/scenarios/kubernetes_e2e.py
      args:
      - --cluster=test-gce-cos-k8sbeta-reboot
      - --check-leaked-resources
      - --provider=gce
      - --gcp-zone=us-west1-b
      - --gcp-node-image=gci
      - --extract=ci/latest-k8sbeta
      - --extract-ci-bucket=k8s-release-dev
      - --timeout=180m
      - --test_args=--ginkgo.focus=\[Feature:Reboot\] --minStartupPods=8
      env:
      image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241128-8df65c072f-master
      resources:
        requests:
          cpu: 1000m
          memory: 3Gi
        limits:
          cpu: 1000m
          memory: 3Gi
  cluster: k8s-infra-prow-build
  annotations:
    testgrid-tab-name: gce-cos-k8sbeta-reboot
    testgrid-dashboards: sig-release-master-blocking
    fork-per-release: "true"
    fork-per-release-replacements: "--extract=ci/latest-k8sbeta -> --extract=ci/latest-{{.Version}}"
    fork-per-release-periodic-interval: 1h 2h 6h 24h
    fork-per-release-generic-suffix: "true"
- interval: 1h
  labels:
    preset-service-account: 'true'
    preset-k8s-ssh: 'true'
  decorate: true
  decoration_config:
    timeout: 680m
  name: ci-kubernetes-e2e-gce-cos-k8sbeta-serial
  spec:
    containers:
    - command:
      - runner.sh
      - /workspace/scenarios/kubernetes_e2e.py
      args:
      - --cluster=test-gce-cos-k8sbeta-serial
      - --check-leaked-resources
      - --provider=gce
      - --gcp-zone=us-west1-b
      - --gcp-node-image=gci
      - --extract=ci/latest-k8sbeta
      - --extract-ci-bucket=k8s-release-dev
      - --timeout=660m
      - --ginkgo-parallel=1
      - --test_args=--ginkgo.focus=\[Serial\]|\[Disruptive\] --ginkgo.skip=\[Driver:.gcepd\]|\[Flaky\]|\[Feature:.+\]|\[sig-cloud-provider-gcp\] --minStartupPods=8
      env:
      image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241128-8df65c072f-master
      resources:
        requests:
          cpu: 1000m
          memory: 3Gi
        limits:
          cpu: 1000m
          memory: 3Gi
  cluster: k8s-infra-prow-build
  annotations:
    testgrid-tab-name: gce-cos-k8sbeta-serial
    testgrid-dashboards: sig-release-master-informing
    testgrid-num-failures-to-alert: '6'
    fork-per-release: "true"
    fork-per-release-replacements: "--extract=ci/latest-k8sbeta -> --extract=ci/latest-{{.Version}}"
    fork-per-release-periodic-interval: 1h 2h 6h 24h
    fork-per-release-generic-suffix: "true"
- interval: 1h
  labels:
    preset-service-account: 'true'
    preset-k8s-ssh: 'true'
  decorate: true
  decoration_config:
    timeout: 170m
  name: ci-kubernetes-e2e-gce-cos-k8sbeta-slow
  spec:
    containers:
    - command:
      - runner.sh
      - /workspace/scenarios/kubernetes_e2e.py
      args:
      - --cluster=test-gce-cos-k8sbeta-slow
      - --check-leaked-resources
      - --provider=gce
      - --gcp-zone=us-west1-b
      - --gcp-node-image=gci
      - --extract=ci/latest-k8sbeta
      - --extract-ci-bucket=k8s-release-dev
      - --timeout=150m
      - --test_args=--ginkgo.focus=\[Slow\] --ginkgo.skip=\[Driver:.gcepd\]|\[Serial\]|\[Disruptive\]|\[Flaky\]|\[Feature:.+\] --minStartupPods=8
      - --ginkgo-parallel=30
      env:
      image: gcr.io/k8s-staging-test-infra/kubekins-e2e:v20241128-8df65c072f-master
      resources:
        requests:
          cpu: 1000m
          memory: 6Gi
        limits:
          cpu: 1000m
          memory: 6Gi
  cluster: k8s-infra-prow-build
  annotations:
    testgrid-tab-name: gce-cos-k8sbeta-slow
    testgrid-dashboards: sig-release-master-informing
    testgrid-num-failures-to-alert: '6'
    fork-per-release: "true"
    fork-per-release-replacements: "--extract=ci/latest-k8sbeta -> --extract=ci/latest-{{.Version}}"
    fork-per-release-periodic-interval: 1h 2h 6h 24h
    fork-per-release-generic-suffix: "true"
